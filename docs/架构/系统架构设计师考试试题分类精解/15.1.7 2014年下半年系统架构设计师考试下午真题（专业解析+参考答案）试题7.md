<div class="detail lh2"><p>请详细阅读有关Web应用架构设计方面的说明，在答题纸上回答问题1至问题3。<br/>【说明】<br/>某软件公司开发运维了一个社交网站系统，该系统基于开源软件平台LAMP（Linux+Apache+MySQL+PHP）构建，运行一段时间以来，随着用户数量及访问量的增加，系统在Web服务器负载、磁盘I/O等方面出现了明显瓶颈，已不能满足大量客户端并发访问的要求，因此公司成立了专门的项目组，拟对系统架构进行调整以提高系统并发处理能力。目前系统采用了传统的三层结构，系统架构如图5-1所示。</p>
<p style="text-align: center;">
    <img alt="" src="https://lstatic.xisaiwang.com/tiku/uploadfiles/2016-07/a370bee81d5942f3aee694009f2e08eb_.png" style="width: 379px; height: 259px;"/></p>
<p style="text-align: center;">
图5-1 某社交网站系统架构</p><br/><br/><div>
【问题1】（10分）</div>
<div>针对目前出现的Web服务器负载过大问题，项目组决定在客户端与中间层Web服务器之间引入负载均衡器，通过中间层Web服务器集群来提高Web请求的并发处理能力。在讨论拟采用的负载均衡机制时，王工提出采用基于DNS的负载均衡机制，而李工则认为应采用基于反向代理的负载均衡机制，项目组经过讨论，最终确定采用李工提出的方案。请用200字以内的文字，分别简要说明两个机制的基本原理，并从系统执行效率、安全性及简易性等方面将两种机制进行对比，将对比结果填入表5-1中。</div>
<div style="text-align: center;">
    <img alt="" src="https://lstatic.xisaiwang.com/tiku/uploadfiles/2016-06/a38cc474aa164acdb981381e3b439baf_.png" style="width: 711px; height: 220px;"/></div>
<div>
【问题2】（7分）</div>
<div>针对并发数据库访问所带来的磁盘I/O瓶颈问题，项目组决定在数据层引入数据库扩展机制。经过调研得知系统数据库中存储的主要数据为以用户标识为索引的社交网络数据，且系统运行时发生的大部分数据库操作为查询操作。经过讨论，项目组决定引入数据库分区和MySQL主从复制两种扩展机制。数据库分区可采用水平分区和垂直分区两种方式，请用350字以内的文字说明在本系统中应采用哪种方式及其原因，并分析引入主从复制机制给系统带来的好处。</div>
<div>
【问题3】（8分）</div>
<div>为进一步提高数据库访问效率，项目组决定在中间层与数据层之间引入缓存机制。赵工开始提出可直接使用MySQL的查询缓存（query cache）机制，但项目组经过分析好友动态显示等典型业务的操作需求，同时考虑已引入的数据库扩展机制，认为查询缓存尚不能很好地提升系统的查询操作效率，项目组最终决定在中间层与数据层之间引入Memcached分布式缓存机制。</div>
<div>（a）请补充下述关于引入Memcached后系统访问数据库的基本过程：系统需要读取后台数据时，先检查数据是否存在于<u>（1）</u>中，若存在则直接从其中读取，若不存在则从<u>（2）</u>中读取并保存在<u>（3）</u>中；当<u>（4）</u>中数据发生更新时，需要将更新后的内容同步到<u>（5）</u>实例中。（备选答案：数据库、Memcached缓存）</div>
<div>（b）请结合已知信息从缓存架构、缓存有效性及缓存数据类型等方面分析使用Memcached代替数据库查询缓存的原因。 </div><br/><br/>答案<br/><div>
【问题1】（10分）<br/>
基于DNS的负载均衡是在DNS服务器中为同一个主机名配置多个IP 地址，在应答DNS 查询时，DNS 服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问引导到不同的节点上去，使得不同的客户端访问不同的节点，从而达到负载均衡的目的。</div>
<div>
反向代理负载均衡。反向代理负载均衡是将来自Internet上的连接请求以反向代理的方式动态地转发给内部网络上的多个节点进行处理，从而达到负载均衡的目的。</div>
<div>
（1）否<span class="Apple-tab-span" style="white-space:pre"> </span><br/>
（2）是</div>
<div>
（3）否<span class="Apple-tab-span" style="white-space:pre"> </span><br/>
（4）是</div>
<div>
（5）否<br/>
（6）是</div>
<div>
（7）是<span class="Apple-tab-span" style="white-space:pre"> </span><br/>
（8）否</div>
<div>
【问题2】（7分）</div>
<div>
本系统应采用水平分区，因为社交网络数据库的数据表记录数量非常庞大，而且记录的访问，大多集中于本地区域，所以水平分区能极大提高处理效率。</div>
<div>
主从复制机制使得同样的数据，存在多个副本，这样让用户查询数据时，可以选择该数据最近的副本进行访问，提高效率，降低资源使用时的冲突。另一方面主从复制机制中一台数据库服务器故障不会导致站点无法访问。</div>
<div>
【问题3】（8分）</div>
<div>
（1）Memcached缓存<span style="white-space: pre;"> </span></div><div>
（2）数据库</div>
<div>
（3）Memcached缓存<span style="white-space: pre;"> </span></div><div>
（4）数据库</div>
<div>
（5）Memcached缓存<span style="white-space: pre;"> </span></div>
<div>
Memcached相比数据库查询缓存：</div>
<div>
缓存架构：数据库查询缓存只是将查询结果进行缓存，适用面很窄，而Memcached缓存是将数据库中的表进行缓存，对于在这些表之上的操作均可适用。</div>
<div>
缓存有效性：Memcached缓存时效较长，只要未更新，就属于有效状态，而数据库查询缓存时效较短（具体时效与配置有关），所以在此方面Memcached缓存有优势。</div>
<div>
缓存数据类型：Memcached缓存数据为表级，而数据库查询缓存为元组级。</div><br/><br/>试题分析<br/><div>
【问题1】
</div><div>基于DNS的负载均衡。基于DNS的负载均衡是在DNS服务器中为同一个主机名配置多个IP 地址，在应答DNS 查询时，DNS 服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果，将客户端的访问引导到不同的节点上去，使得不同的客户端访问不同的节点，从而达到负载均衡的目的。</div>
<div>
DNS 负载均衡的优点是经济、简单易行，并且节点可以位于Internet上任意的位置。但它也存在不少缺点，例如，为了保证DNS数据及时更新，一般都要将DNS的刷新时间设置得较小，但太小就会造成太大的额外网络流量，并且更改了DNS数据之后也不能立即生效；DNS负载均衡采用的是简单的轮转算法，不能区分节点之间的差异，不能反映节点的当前运行状态，不能做到为性能较好的节点多分配请求，甚至会出现客户请求集中在某一个节点上的情况。另外，要给每个节点分配一个Internet上的IP地址，这势必会占用过多的IP地址。</div>
<div>
反向代理负载均衡。反向代理负载均衡是将来自Internet上的连接请求以反向代理的方式动态地转发给内部网络上的多个节点进行处理，从而达到负载均衡的目的。反向代理负载均衡既能以软件方式实现，也能在高速缓存器和负载均衡器等硬件设备上实现。反向代理负载均衡可以将优化的负载均衡策略和代理服务器的高速缓存技术结合在一起，提升静态网页的访问速度，提高系统性能。另外，由于网络外部用户不能直接访问真实的节点计算机，反向代理负载均衡还具备额外的安全性（同理，基于NAT的负载均衡也有此优点）。</div>
<div>
反向代理负载均衡的缺点主要表现在两个方面。首先，反向代理处于OSI参考模型应用层，因此，必须为每种应用服务专门开发一个反向代理服务器，这样，就限制了反向代理负载均衡技术的应用范围，现在一般都用于对Web服务器的负载均衡；其次，针对每一次代理，代理服务器都必须打开两个连接，一个对外，一个对内。在并发连接请求数量非常大的时候，代理服务器的负载也就非常大，代理服务器本身会成为服务的瓶颈。</div><p>
【问题2】 <br/></p><p>根据已知信息，系统数据库中存储的主要数据为以用户标识为索引的社交网络数据，采水平分区机制可根据用户标识将用户数据进行水平分割，用户操作时先将请求分发到不同数据库分区，再进行具体数据库操作，以提高数据库访问效率。因此本系统中应主要使用水平分区机制。在系统中引入主从复制机制，首先可以利用主从复制机制的备份功能避免系统数据库单点故障：其次已知“系统运行时发生的大部分数据库操作为查询操作”。因此可以使用主数据库进行数据的插入、删除及更新等写操作，而从数据库则专门用来进行数据查询操作，从而将查询操作分担到不同的从服务器以提高数据库访问效率。<br/></p><p></p><p>
【问题3】
</p>
<div> Memcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。</div>
<div> Mysql查询缓存的作用就是当查询接收到一个和之前同样的查询，服务器将会从查询缓存种检索结果，而不是再次分析和执行上次的查询。这样就大大提高了性能，节省时间。 <br/></div><p>与MySQL查询缓存相比，使用Memcached机制存在以下优势：<br/>（1）缓存架构：数据库查询缓存通常每个数据库只有一个实例，因此存储内容受数据库服务器可用内存限制；可缓存数据有限；而Memcached可采用高速分布式缓存服务器结构，不受数据库服务器约束，可扩展性更好。<br/>（2）缓存有效性：数据库查询缓存只要在发生写操作时就会失效，即使更新的是数据库中的其他行；而
Memcached
可通过键值将数据进行散列缓存，有效降低缓存的更新频率，从而提高缓存的有效性。<br/>（3）缓存数据类型：数据库查询缓存只能缓存数据库行，对社交网站好友动态显示等典型业务所需婴門组合数据缓存缺乏有效支持，而Memcached理论上可缓存任何内容，因此可以将分散在数据库中的关系或者列表组合后进行缓存，以提高缓存数据的针对性和效率。<br/></p><p><br/></p></div>