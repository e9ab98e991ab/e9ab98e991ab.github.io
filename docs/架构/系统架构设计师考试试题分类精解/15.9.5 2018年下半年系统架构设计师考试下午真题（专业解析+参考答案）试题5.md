<div class="detail lh2"><p>阅读以下关于分布式数据库缓存设计的叙述，在答题纸上回答问题1至问题3。<br/>【说明】 <br/>某企业是为城市高端用户提供高品质蔬菜生鲜服务的初创企业，创业初期为快速开展业务，该企业采用轻量型的开发架构（脚本语言+关系型数据库）研制了一套业务系统。业务开展后受到用户普遍欢迎，用户数和业务数量迅速增长，原有的数据库服务器已不能满足高度并发的业务要求。为此，该企业成立了专门的研发团队来解决该问题。<br/>张工建议重新开发整个系统， 采用新的服务器和数据架构，解决当前问题的同时为日后的扩展提供支持。但是，李工认为张工的方案开发周期过长，投入过大，当前应该在改动尽量小的前提下解决该问题。李工认为访问量很大的只是部分数据，建议采用缓存工具MemCache来减轻数据库服务器的压力，这样开发量小，开发周期短，比较适合初创公司，同时将来也可以通过集群进行扩展。然而，刘工又认为李工的方案中存在数据可靠性和一致性问题，在宕机时容易丢失交易数据，建议采用Redis来解决问题。在经过充分讨论，该公司最终决定采用刘工的方案。<br/></p><br/><br/><p>【问题1】（9分）<br/></p><p>在李工和刘工的方案中，均采用分布式数据库缓存技术来解决问题。请用100字以内的文字说明分布式数据库缓存的基本概念。<br/>表4-1中对MemCache和Redis两种工具的优缺点进行了比较，请补充完善表 4-1中的空（1）~ （6）。</p><p><img src="https://img.kuaiwenyun.com/images/shiti/2019-10/149/iiWIzWyFc5.png" style="max-width: 100%;"/></p><div style="text-align: center;"><br/></div><p>【问题2】 （8分）<br/>刘工认为李工的方案存在数据可靠性和一致性的问题，请用100字以内的文字解释说明。<br/>为避免数据可靠性和一致性的问题，刘工的方案采用Redis作为数据库缓存，请用200字以内的文字说明基本的Redis与原有关系数据库的数据同步方案。<br/>【问题3】 （8分）<br/>请用300字以内的文字，说明Redis分布式存储的两种常见方案，并解释说明Redis集群切片的几种常见方式。</p><br/><br/>答案<br/>【问题1】<div>分布式数据库缓存指的是在高并发环境下，为了减轻数据库压力和提高系统响应时间，在数据库系统和应用系统之间增加的独立缓存系统。<br/>
（1）key/value，list，set，hash，sorted 或 丰富/多种数据结构<br/>
（2）不支持<br/>
（3）客户端哈希分片/一致性哈希<br/>
（4）不支持<br/>
（5）有，私有内存池<br/>
（6）不支持<br/><p>【问题2】<br/>（1）MemCache没有持久化功能，所以掉电数据会全部丢失，而且无法直接恢复，这存在可靠性问题。<br/>（2）MemCache不支持事务，所以操作过程中可能产生数据的不一致性。<br/>同步方案：<br/>读取数据时，先读取Redis中的数据，如果Redis没有，则从原数据库中读取，并同步更新Redis中的数据。写回时，写入到原数据库中，并同步更新至Redis中。 <br/>【问题3】<br/>Redis分布式存储的常见方案：<br/>1、主从模式（Master/Slave）<br/>2、哨兵模式（Sentinel）<br/>3、集群模式（Cluster）<br/>Redis集群切片的常见方式：<br/>1、客户端分片，即在客户端就通过key的hash值对应到不同的服务器。<br/>2、中间件实现分片。在应用软件和Redis中间，例如：Twemproxy、Codis等，由中间件实现服务到后台Redis节点的路由分派。<br/>3、客户端服务端协作分片。Redis Cluster模式，客户端可采用一致性哈希，服务端提供错误节点的重定向服务slot上。不同的slot对应到不同服务器。<br/></p></div><br/><br/>试题分析<br/><p>本题主要考查概念性内容。<br/>MemCache与Redis主要的差异表现在以下方面：<br/>1、Redis和MemCache都是将数据存放在内存中，都是内存数据库。他们都支持key-value数据类型。同时MemCache还可用于缓存其他东西，例如图片、视频等等，Redis还支持list、set、hash等数据结构的存储。<br/>2、Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。MemCache挂掉之后，数据就没了。<br/>3、灾难恢复-MemCache挂掉后，数据不可恢复； Redis数据丢失后可以恢复。<br/>4、在Redis中，并不是所有的数据都一直存储在内存中的。这是和MemCache相比一个最大的区别。当物理内存用完时，Redis可以将一些很久没用到的value交换到磁盘。<br/>5、Redis在很多方面支持数据库的特性，可以这样说他就是一个数据库系统，而MemCache只是简单地K/V缓存。<br/>所以在选择方面如果有持久方面的需求或对数据类型和处理有要求的应该选择Redis。<br/>如果简单的key/value存储应该选择MemCache。</p><p>【问题2】<br/>本问题考查两种工具对数据可靠性和一致性的支持，并考查方案的设计能力。<br/>MemCache无法进行持久化，数据不能备份，只能用于缓存使用，数据全部存在于内存，一旦重启数据会全部丢失。Redis支持数据的持久化。因此李工的方案存在数据可靠性和一致性问题，而刘工的方案解决了该问题。<br/>刘工的方案中，采用Redis作为缓存，使得一份数据同时存储在缓存和关系数据库中，因此必须给出一个数据同步的方案。刘工的方案中，保留原有关系数据库，将Redis仅作为缓存，即热点数据缓存在Redis中，核心业务的结构化数据存储在原有关系数据库中，由于Redis只作为缓存，因此给出原关系数据库到Redis的同步方案即可。该方案的基本操作如下：<br/>1.读操作，读缓存Redis，如果数据不存在，从原关系数据厍中读数据，并将读取后的数据值写入到Redis；<br/>2.写操作，写原关系数据库，写成功后，更新或者失效掉缓存Redis中的值。<br/>【问题3】<br/>Redis为单点方案，使用时必须提供分布式存储的集群拓展能力。Redis分布式存储的常见方案有主从（Master/Slave）模式、哨兵（Sentinel）模式、集群（Cluster）模式。<br/>Redis集群切片的常见方式有：<br/>（1）客户端实现分片方式，分区逻辑在客户端实现，采用一致性哈希来决定Redis节点。<br/>（2）中间件实现分片方式，即在应用软件和Redis中间，例如Twemproxy、Codis等，由中间件实现服务到后台Redis节点的路由分派。<br/>（3）客户端服务端协作分片方式，Redis Cluster模式。客户端可采用一致性哈希，服务端提供错误节点的重定向服务。 </p><p></p></div>